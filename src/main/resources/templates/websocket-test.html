<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real-Time Stock Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        h2 { text-align: center; }
        #status { font-weight: bold; text-align: center; margin-bottom: 10px; }
        table { border-collapse: collapse; width: 100%; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #333; color: white; }
        tr:nth-child(even){background-color: #f9f9f9;}
        tr:hover { background-color: #f1f1f1; }
        .price-up { color: green; font-weight: bold; }
        .price-down { color: red; font-weight: bold; }
        .high-volume { background-color: #ffeb3b; }
    </style>
</head>
<body>

<h2>ðŸ“ˆ Real-Time Stock Dashboard</h2>
<div id="status">ðŸ”´ Disconnected</div>

<table>
    <thead>
    <tr>
        <th>Symbol</th>
        <th>Price</th>
        <th>Volume</th>
        <th>Timestamp</th>
    </tr>
    </thead>
    <tbody id="tickTable">
    </tbody>
</table>

<script>
    let stompClient = null;
    const lastPrices = {}; // keep track of last price per symbol

    function connect() {
        const socket = new SockJS('http://localhost:8080/ws-stock');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            document.getElementById('status').innerText = 'âœ… Connected';
            console.log('Connected: ' + frame);

            stompClient.subscribe('/topic/ticks/*', function (message) {
                const tick = JSON.parse(message.body);
                addTickToTable(tick);
            });
        }, function(error) {
            document.getElementById('status').innerText = 'âŒ Disconnected';
            console.error(error);
        });
    }

    function addTickToTable(tick) {
    const table = document.getElementById('tickTable');
    let row = document.getElementById('row-' + tick.symbol);

    // Price comparison
    const lastPrice = lastPrices[tick.symbol];
    let priceClass = '';
    if (lastPrice !== undefined) {
        priceClass = tick.price > lastPrice ? 'price-up' : (tick.price < lastPrice ? 'price-down' : '');
    }
    lastPrices[tick.symbol] = tick.price;

    if (!row) {
        // create new row if it doesn't exist
        row = table.insertRow(0);
        row.id = 'row-' + tick.symbol;
        row.insertCell(0); // symbol
        row.insertCell(1); // price
        row.insertCell(2); // volume
        row.insertCell(3); // timestamp
    }

    row.cells[0].innerText = tick.symbol;
    row.cells[1].innerText = tick.price.toFixed(2);
    row.cells[1].className = priceClass;
    row.cells[2].innerText = tick.volume;
    row.cells[2].className = tick.volume > 500 ? 'high-volume' : '';
    row.cells[3].innerText = new Date(tick.timestamp).toLocaleTimeString();
}


    window.onload = connect;
</script>

</body>
</html>
